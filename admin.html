<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="path_to/sweetalert.css">
<script src="path_to/sweetalert.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
</head>
<body>
  <header>
    <!-- Your header content goes here -->
    <nav class="navbar navbar-expand-lg navbar-light bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="#">  <img src="images/dob.png" style="width:170px;height:70px"></a>
        <div class="heading">Admin</div>
        <nav class="navbar navbar-expand-lg navbar-light bg-dark fixed-top">
          <div class="container">
            <a class="navbar-brand" href="#">  <img src="images/doblogoo.png" style="width:250px;height:70px"></a>
            <div class="heading">Admin</div>
            <div class="logout">
              <!-- Add SweetAlert to the logout button -->
              <button type="logout" class="btn" id="logoutButton">logout</button>
            </div>
            </div>
            </nav>
            
            <!-- Include SweetAlert library -->
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            
            <script>
              // Attach SweetAlert to the logout button
              document.getElementById('logoutButton').addEventListener('click', function () {
                Swal.fire({
                  title: 'Logout',
                  text: 'Are you sure you want to logout?',
                  icon: 'warning',
                  showCancelButton: true,
                  confirmButtonText: 'Yes, logout',
                  cancelButtonText: 'Cancel',
                }).then((result) => {
                  if (result.isConfirmed) {
                    // Perform logout action here
                    // Redirect to index.html
                    window.location.href = 'index.html';
                  }
                });
              });
            </script>
            
        
      </div>
    </nav>

  </header>

  <div class="container-fluid" style="margin-top: 100px;">
    <div class="row" style="position: sticky;">
      <!-- Sidebar -->
      <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar"> 
        <!-- ... Rest of the sidebar ... -->
        <ul class="nav flex-column" style="position: fixed;">
          <li class="nav-item">
            <button class="nav-link btn btn-link active" onclick="loadContent('stories')">Add Stories</button>
          </li>
          <li class="nav-item">
            <button class="nav-link btn btn-link active" onclick="loadContent('storieslist')">stories List</button>
          </li>
          <li class="nav-item">
            <button class="nav-link btn btn-link active" onclick="loadContent('enquiry')">Appointment&nbsp;List</button>
          </li>
          <li class="nav-item">
            <button class="nav-link btn btn-link active" onclick="loadContent('contact')">Contact Us</button>
          </li>
          <li class="nav-item">
            <button class="nav-link btn btn-link active" onclick="loadContent('pricing')">Add Pricing</button>
          </li>
          <li class="nav-item">
            <button class="nav-link btn btn-link active" onclick="loadContent('pricinglist')">Pricing List</button>
          </li>
      
        </ul>
      </nav>
      

      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" id="main-content">
        <section class="content-section active" id="stories">
          <h1>Add Story</h1>
      
          <form id="storyForm" enctype="multipart/form-data">
            <label for="photo">Select a photo:</label>
            <input type="file" id="photo" name="album" accept="image/*" required>
            
            <br>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required>
            <br>
            <br>
            <label for="Date">Date:</label>
            <input type="date" id="Date" name="Date" required>
            <br>
            <label for="description">Description:</label>
            <textarea id="description" name="subtitle" rows="4" required></textarea>
            <br>
   
            <input type="submit" value="Upload Photo">
        </form>
        <div class="popup-modal" id="popupModal">
          <div class="popup-content">
            <h2>Thank You!</h2>
            <p>Your form has been submitted successfully.</p>
            <button type="button" class="close-btn" id="closeBtn">Close</button>
          </div>
        </div>
      </section>
   

<script>
  const storyForm = document.getElementById('storyForm');

  storyForm.addEventListener('submit', (event) => {
    event.preventDefault();

    const formData = new FormData(storyForm);

    fetch('http://18.214.88.216:80/api/stories/stories', {
      method: 'POST',
      body: formData,
    })
      .then((response) => {
        storyForm.reset(); 
        if (response.ok) {
          return response.json();
        } else {
          throw new Error('POST request failed!');
        }
      })
    
      .then((data) => {
        // Process the response data here if needed
        console.log('POST request successful!', data);
      })
      .catch((error) => {
        console.error('Error:', error.message);
        // Handle the error scenario
      });
  });
</script>





<section class="content-section" id="enquiry">
         <h1>Appointment List</h1>
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Location</th>
                <th>Photo Session</th>
                <th>Contact Number</th>
                <th>Birthday Date</th>
                <th>Reference</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="appointmentTableBody">
                
              
            </tbody>
        </table>
        
        <div class="pagination-container">
          <button class="pagination-button" onclick="prevAppointmentPage()">Previous</button>
          <span class="pagination-info">
            Page <span id="currentAppointmentPage">1</span> / <span id="totalAppointmentPages">1</span>
          </span>
          <button class="pagination-button" onclick="nextAppointmentPage()">Next</button>
        </div>
        </section>
         <script>
          const appointmentsPerPage = 5;
          let currentAppointmentPage = 1;
          let appointmentData = [];
          let startingSerialNumber = 1;
          
          function fetchAndPopulateAppointmentTable(page) {
            fetch('http://18.214.88.216:80/api/appointment/appointments')
              .then(response => response.json())
              .then(data => {
                appointmentData = data;
                populateAppointmentTable(page);
              })
              .catch(error => {
                console.error('Failed to fetch appointments:', error);
              });
          }
          
          function populateAppointmentTable(page) {
            const tableBody = document.getElementById('appointmentTableBody');
            tableBody.innerHTML = '';
          
            const startIndex = (page - 1) * appointmentsPerPage;
            const endIndex = startIndex + appointmentsPerPage;
          
            for (let i = startIndex; i < endIndex && i < appointmentData.length; i++) {
              const appointment = appointmentData[i];
              const newRow = document.createElement('tr');
              newRow.innerHTML = `
                <td>${startingSerialNumber}</td>
                <td>${appointment.name}</td>
                <td>${appointment.email}</td>
                <td>${appointment.location}</td>
                <td>${appointment.message}</td>
                <td>${appointment.contact_no}</td>
                <td>${appointment.date}</td>
                <td>${appointment.reference}</td>
                <td><button class="delete-btn" data-id="${appointment.id}">Delete</button></td>`;
              tableBody.appendChild(newRow);
              startingSerialNumber++;
            }
          
            const totalAppointmentPages = Math.ceil(appointmentData.length / appointmentsPerPage);
            document.getElementById('totalAppointmentPages').textContent = totalAppointmentPages;
            document.getElementById('currentAppointmentPage').textContent = page;
          }
          
          function prevAppointmentPage() {
            if (currentAppointmentPage > 1) {
              currentAppointmentPage--;
              startingSerialNumber = (currentAppointmentPage - 1) * appointmentsPerPage + 1;
              fetchAndPopulateAppointmentTable(currentAppointmentPage);
            }
          }
          
          function nextAppointmentPage() {
            const totalAppointmentPages = Math.ceil(appointmentData.length / appointmentsPerPage);
            if (currentAppointmentPage < totalAppointmentPages) {
              currentAppointmentPage++;
              startingSerialNumber = (currentAppointmentPage - 1) * appointmentsPerPage + 1;
              fetchAndPopulateAppointmentTable(currentAppointmentPage);
            }
          }
          
          fetchAndPopulateAppointmentTable(currentAppointmentPage);
          </script> 




<section class="content-section" id="contact">
  <h1>Contact List</h1>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone Number</th>
        <th>Message</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="contactTableBody">
      <!-- Rows will be populated here -->
    </tbody>
  </table>
  
  <div class="pagination-container">
    <button class="pagination-button" onclick="prevPage()">Previous</button>
    <span class="pagination-info">
      Page <span id="currentPage">1</span> / <span id="totalPages">1</span>
    </span>
    <button class="pagination-button" onclick="nextPage()">Next</button>
  </div>
  
  
</section>

<!-- Your HTML structure -->
<!-- Your HTML structure -->

<script>
  const contactsPerPage = 10;
  let currentPage = 1;
  let data = [];
  let startingSerialNumberr = 1; // Initialize the starting serial number

  function fetchContacts() {
    fetch('http://18.214.88.216:80/api/contactus/contacts')
      .then(response => response.json())
      .then(responseData => {
        data = responseData;
        fetchAndPopulateTable();
      })
      .catch(error => {
        console.error('Failed to fetch contacts:', error);
      });
  }

  function fetchAndPopulateTable() {
    const tableBody = document.getElementById('contactTableBody');
    tableBody.innerHTML = '';

    const startIndex = (currentPage - 1) * contactsPerPage;
    const endIndex = startIndex + contactsPerPage;

    for (let i = startIndex; i < endIndex && i < data.length; i++) {
      const contact = data[i];
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td>${startingSerialNumberr}</td>
        <td>${contact.name}</td>
        <td>${contact.email}</td>
        <td>${contact.phonenumber}</td>
        <td>${contact.message}</td>
        <td><button class="delete-btn" data-id="${contact.id}">Delete</button></td>
      `;
      tableBody.appendChild(newRow);
      startingSerialNumberr++;
    }

    const totalPages = Math.ceil(data.length / contactsPerPage);
    document.getElementById('totalPages').textContent = totalPages;
  }

  function prevPage() {
    if (currentPage > 1) {
      currentPage--;
      startingSerialNumberr = (currentPage - 1) * contactsPerPage + 1; // Update the starting serial number
      document.getElementById('currentPage').textContent = currentPage;
      fetchAndPopulateTable();
    }
  }

  function nextPage() {
    const totalPages = Math.ceil(data.length / contactsPerPage);
    if (currentPage < totalPages) {
      currentPage++;
      startingSerialNumberr = (currentPage - 1) * contactsPerPage + 1; // Update the starting serial number
      document.getElementById('currentPage').textContent = currentPage;
      fetchAndPopulateTable();
    }
  }

  // Attach the deleteContactEntry() function to the onclick event of each delete button
  document.getElementById('contactTableBody').addEventListener('click', function(event) {
    if (event.target && event.target.matches('button.delete-btn')) {
      const contactId = event.target.dataset.id;
      deleteContactEntry(contactId);
    }
  });

  function deleteContactEntry(id) {
    
    fetchAndPopulateTable();
  }

  fetchContacts();
</script> 



        <section class="content-section" id="pricing">
          <h1>Pricing</h1>
          <form id="pricingForm">
            <div class="form-group">
              <label for="photo">Photo:</label>
              <input type="file" class="form-control" id="image" name="image" accept="image/*">
            </div>
            <div class="form-group">
              <label for="albumType">Album Type:</label>
              <input type="text" class="form-control" id="title" name="title" required>
            </div>

           <div class="form-group">
            <label for="price">Prize:</label>
            <input type="text" class="form-control" id="price" name="price" required>
            </div> 

            <div class="form-group">
              <label for="description">Description:</label>
              <textarea class="form-control" id="subtitle" name="subtitle" rows="3" required></textarea>
            </div>
     
            <div class="form-group">
              <label for="termsAndConditions">Terms and Conditions:</label>
              <textarea class="form-control" id="terms_and_conditions" name="terms_and_conditions" rows="5" required></textarea>
            </div>
            <input type="submit" value="Submit">
          </form>
           <div class="popup-modal" id="popupModal">
            <div class="popup-content">
              <h2>Thank You!</h2>
              <p>Your form has been submitted successfully.</p>
              <button type="button" class="close-btn" id="closeBtn">Close</button>
            </div>
          </div>
        </section>


<script>
  const pricingForm = document.getElementById('pricingForm');

  pricingForm.addEventListener('submit', (event) => {
    event.preventDefault();

    const formData = new FormData(pricingForm);

    fetch('http://18.214.88.216:80/api/pricing/pricing', {
      method: 'POST',
      body: formData,
    })
      .then((response) => {
        pricingForm.reset();
        if (response.ok) {
          return response.json(); // Parse the JSON data from the response
        } else {
          throw new Error('POST request failed!');
        }
      })
      .then((data) => {
        // Process the response data here if needed
        console.log('POST request successful!', data);
      })
      .catch((error) => {
        console.error('Error:', error.message);
        // Handle the error scenario
      });
  });
</script>


<section class="content-section" id="pricinglist">
  <h1>pricing  List</h1>
  <table>
    <thead>
      <tr>
        <th>id</th>
        <th>Image</th>
        <th>title</th>
        <th>subtitle</th>
        <th>terms_and_conditions</th>
        <th>price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="pricingListTableBody">
      
    </tbody>

  </table>
  <div id="pagination">

  </div>
</section>

<section class="content-section" id="storieslist">
  <h1>Stories List</h1>
  <table class="table">
    <thead class="thead-dark">
      <tr>
        <th>id</th>
        <th>Image</th>
        <th>title</th>
        <th>subtitle</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="storiesListTableBody">

    </tbody>
  </table>

   <!-- Pagination container -->
   <div class="pagination-container">
    <button class="pagination-button" onclick="prevStoriesPage()">Previous</button>
    <span class="pagination-info">
      Page <span id="currentStoriesPage">1</span> / <span id="totalStoriesPages">1</span>
    </span>
    <button class="pagination-button" onclick="nextStoriesPage()">Next</button>
  </div>
</section>

<script>
  function fetchAndPopulateStoriesList() {
    fetch('http://18.214.88.216:80/api/stories/stories')
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to fetch stories data');
        }
        return response.json();
      })
      .then(data => {
        const tableBody = document.getElementById('storiesListTableBody');
        tableBody.innerHTML = '';
  
        let startingSerialNumber = 1; // Initialize the starting serial number
  
        data.forEach(storyEntry => {
          const newRow = document.createElement('tr');
  
          const idCell = document.createElement('td');
          idCell.textContent = startingSerialNumber; // Use the serial number
          newRow.appendChild(idCell);
  
          const imageCell = document.createElement('td');
          const imageElement = document.createElement('img');
          const imageData = new Uint8Array(storyEntry.album.data);
          const base64Image = encodeImageToBase64(imageData); 
          imageElement.src = `data:image/png;base64,${base64Image}`;
          imageElement.alt = 'Story Image';
          imageElement.style.maxWidth = '100px';
          imageCell.appendChild(imageElement);
          newRow.appendChild(imageCell);
  
          newRow.innerHTML += `
            <td>${storyEntry.title}</td>
            <td style="max-width: 200px; word-wrap: break-word;">${storyEntry.subtitle}</td>
            <td>${storyEntry.Date}</td>
            <td style="width: 200px;">
              <button class="action-button" onclick="openStoriesModal(${storyEntry.sid})">Edit</button>
            <button class="action-button" onclick="deleteStoryEntry(${storyEntry.sid})">Delete</button><br>
            <button class="action-button" onclick="openAlbum(${storyEntry.sid})">AddAlbum</button>
            </td>
          `;
  
          tableBody.appendChild(newRow);
          startingSerialNumber++;
        });
      })
      .catch(error => {
        console.error('Error:', error.message);
      });
  }
  // Function to encode the Uint8Array image data to base64
  function encodeImageToBase64(imageData) {
    let binary = '';
    for (let i = 0; i < imageData.length; i++) {
      binary += String.fromCharCode(imageData[i]);
    }
    return window.btoa(binary);
  }
  
  document.addEventListener('DOMContentLoaded', fetchAndPopulateStoriesList);
  </script>
  

    </div>
  </div>




    
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    function loadContent(contentType) {
      var mainContent = document.getElementById("main-content");
      var sections = mainContent.getElementsByClassName("content-section");
  
      for (var i = 0; i < sections.length; i++) {
        sections[i].classList.remove("active");
      }
  
      var contentSection = document.getElementById(contentType);
      contentSection.classList.add("active");
  
      if (contentType === 'pricinglist') {
        fetchAndPopulatePricingList(); // Call the new function to fetch and populate the pricing list
      } else if (contentType === 'storieslist') {
        fetchAndPopulateStoriesList(); // Call the new function to fetch and populate the stories list
      }
    }
  
    function fetchAndPopulatePricingList() {
   
    }
  
    function fetchAndPopulateStoriesList() {
      
    }
  </script>
  
  




<!-- Edit Modal for pricing -->
<div id="editModal" class="modal">
  <div class="modal-contents">
    <h2>Edit Pricing Entry</h2>
    <form id="pricingForm">
      <input type="hidden" id="editEntryId" name="editEntryId">
      <label for="editImage">Image:</label>
      <input type="file" id="editImage" name="image" accept="image/*">
      <img id="imagePreview" src="" alt="Image Preview" style="max-width: 200px; display: none;">      
      <br>
      <label for="editTitle">Title:</label>
      <input type="text" id="editTitle" name="title" required>
      <br>
      <label for="editSubtitle">Subtitle:</label>
      <input type="text" id="editSubtitle" name="subtitle" required>
      <br>
      <label for="editTermsAndConditions">Terms And Conditions:</label>
      <input type="text" id="editTermsAndConditions" name="terms_and_conditions" required>
      <br>
      <label for="editPrice">Price:</label>
      <input type="text" id="editPrice" name="price" required>
      <button type="submit">Save</button>
      <button type="button" onclick="closeEditModal()" style="background-color: aqua;">Close</button>
    </form>
  </div>
</div>

<script>
  function openEditModal(entryId) {
    const editModal = document.getElementById('editModal');
    editModal.style.display = 'block';
 
    fetch(`http://18.214.88.216:80/api/pricing/pricings/${entryId}`)
      .then(response => response.json())
      .then(pricingEntry => {
        // Populate form fields with the retrieved data
        document.getElementById('editEntryId').value = pricingEntry.id;
        document.getElementById('editTitle').value = pricingEntry.title;
        document.getElementById('editSubtitle').value = pricingEntry.subtitle;
        document.getElementById('editTermsAndConditions').value = pricingEntry.terms_and_conditions;
        document.getElementById('editPrice').value = pricingEntry.price;

        // Show the edit modal
        document.getElementById('editModal').style.display = 'block';
      })
      .catch(error => {
        console.error('Error fetching pricing entry:', error);
      });
  }
  
  function closeEditModal() {
    const editModal = document.getElementById('editModal');
    editModal.style.display = 'none';
  }


//put method to save the changes
document.getElementById('pricingForm').addEventListener('submit', function(event) {
    event.preventDefault(); 
    console.log('Form submission handler called.');
    const formData = new FormData();
    formData.append('title', document.getElementById('editTitle').value);
    formData.append('subtitle', document.getElementById('editSubtitle').value);
    formData.append('terms_and_conditions', document.getElementById('editTermsAndConditions').value);
    formData.append('price', document.getElementById('editPrice').value);
    
    const entryId = document.getElementById('editEntryId').value; // Retrieve entryId from the hidden input field

    fetch(`http://18.214.88.216:80/api/pricing/pricing/${entryId}`, {
      method: 'PUT',
      body: formData,
    })
    .then(response => response.json())
    .then(updatedData => {
      console.log('Entry updated:', updatedData);
      closeEditModal();
    })
    .catch(error => {
      console.error('Error updating entry:', error);
    });
});

</script>






<script>
  // Function to fetch and populate the pricing list
  function fetchAndPopulatePricingList() {
    fetch('http://18.214.88.216:80/api/pricing/pricing')
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to fetch pricing data');
        }
        return response.json();
      })
      .then(data => {
        const tableBody = document.getElementById('pricingListTableBody');
        tableBody.innerHTML = '';

        let startingSerialNumber = 1; // Initialize the starting serial number

        data.forEach(pricingEntry => {
          const newRow = document.createElement('tr');

          const idCell = document.createElement('td');
          idCell.textContent = startingSerialNumber; // Use the serial number
          newRow.appendChild(idCell);

          const imageCell = document.createElement('td');
          const imageElement = document.createElement('img');
          const imageData = new Uint8Array(pricingEntry.image.data);
          const base64Image = encodeImageToBase64(imageData);
          imageElement.src = `data:image/png;base64,${base64Image}`;
          imageElement.alt = 'Pricing Image';
          imageElement.style.maxWidth = '100px';
          imageCell.appendChild(imageElement);
          newRow.appendChild(imageCell);

          newRow.innerHTML += `
            <td>${pricingEntry.title}</td>
            <td>${pricingEntry.subtitle}</td>
            <td>${pricingEntry.terms_and_conditions}</td>
            <td>${pricingEntry.price}</td>
            <button data-id="${pricingEntry.id}" onclick="openEditModal(this.dataset.id)">Edit</button>
            <button onclick="deletePricingEntry(${pricingEntry.id})">Delete</button>
          `;

          tableBody.appendChild(newRow);
          startingSerialNumber++;
        });
      })
      .catch(error => {
        console.error('Error:', error.message);
      });
  }

  // Function to encode the Uint8Array image data to base64
  function encodeImageToBase64(imageData) {
    let binary = '';
    for (let i = 0; i < imageData.length; i++) {
      binary += String.fromCharCode(imageData[i]);
    }
    return window.btoa(binary);
  }
</script>



<script>
  const Form = document.getElementById('stories');

  stories.addEventListener('submit', (event) => {
    event.preventDefault();


    const popupModal = document.getElementById('popupModal');
    popupModal.style.display = 'flex';

    const closeBtn = document.getElementById('closeBtn');
    closeBtn.addEventListener('click', () => {
      popupModal.style.display = 'none';
    });
    stories.reset();
  });
</script>




<!--Add Album by storyId-->
<div id="AddAlbum" class="modal" style="width: 40%; margin: auto;">
  <div class="modal-content">
    <h2>Add Album Entry</h2>
    <form id="addAlbum">
      <label for="editImage">Image:</label>
      <input type="file" id="albumImage" name="images" accept="image/*" multiple>
      <br>
     
      <button type="button" onclick="saveAlbum()" class="modal-close-button">Save</button>
      <button type="button" onclick="closeAlbumModal()" style="background-color: aqua;">Close</button>
    </form>
  </div>
</div>


<script>
  function closeAlbumModal() {
    const addAlbumModal = document.getElementById('AddAlbum'); // Get the modal element
    addAlbumModal.style.display = 'none'; // Hide the modal directly
  }
  
  </script>

<script>
  let currentEditEntryId = null; 
  function openAlbum(entryId) {
    currentEditEntryId = entryId;
    const addAlbumModal = document.getElementById('AddAlbum');
    addAlbumModal.style.display = 'block';
  
    addAlbumModal.querySelector('.modal-content').classList.add('show-modal');
  }
  
  function closeAlbum() {
    const addAlbumModal = document.getElementById('AddAlbum');
    const modalContent = addAlbumModal.querySelector('.modal-content');
    
   
    modalContent.classList.remove('show-modal');
    setTimeout(() => {
      addAlbumModal.style.display = 'none';
    }, 300); 
  }

  function saveAlbum() {
    var formElement = document.getElementById('addAlbum');
    var formData = new FormData(formElement);

    const sid = currentEditEntryId;

    formData.append('sid', sid);

    fetch(`http://18.214.88.216:80/api/photos/photos/${sid}`, {
      method: 'POST',
      body: formData,
    })
      .then((response) => {
        if (response.ok) {
          return response.json();
        } else {
          throw new Error('POST request failed!');
        }
      })
      .then((data) => {
        console.log('POST request successful!', data);
        formElement.reset();
        closeAlbum();
      })
      .catch((error) => {
        console.error('Error:', error.message);
      });
  }
  </script>
  

<!--edit stories form-->
<div id="editFormContainer" style="display: none;">
  <h2>Edit Story</h2>
  <form id="editStoryForm">
    <input type="hidden" id="editStoryId" name="sid">
    <label for="editStoryAlbum">Album:</label>
    <input type="text" id="editStoryAlbum" name="album">
    <br>
    <label for="editStoryDate">Date:</label>
    <input type="text" id="editStoryDate" name="Date">
    <br>
    <label for="editStoryTitle">Title:</label>
    <input type="text" id="editStoryTitle" name="title">
    <br>
    <label for="editStorySubtitle">Subtitle:</label>
    <textarea id="editStorySubtitle" name="subtitle"></textarea>
    <br>
    <button type="submit">Save</button>
    <button type="button" onclick="cancelEdit()">Cancel</button>
  </form>
<div class="popup-modal" id="popupModal">
  <div class="popup-content">
    <h2>Thank You!</h2>
    <p>Your form has been updated successfully.</p>
    <button type="button" class="close-btn" id="closeBtn">Close</button>
  </div>
</div>
</section>

<script>
  function closeAlbum() {
    const addAlbumModal = document.getElementById('storiesModal'); // Get the modal element
    addAlbumModal.style.display = 'none'; // Hide the modal directly
  }
  
  </script>
<script>
// Modify openStoriesModal function to populate the edit form
// Function to open the edit form and populate it with data
function openStoriesModal(storyId) {
  // Fetch the story data for the selected storyId
  fetch(`http://18.214.88.216:80/api/stories/${storyId}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Failed to fetch story data');
      }
      return response.json();
    })
    .then(data => {
      // Populate the edit form fields with the fetched data
      document.getElementById('editStoryId').value = storyId;
      document.getElementById('editStoryAlbum').value = data.album;
      document.getElementById('editStoryDate').value = data.Date;
      document.getElementById('editStoryTitle').value = data.title;
      document.getElementById('editStorySubtitle').value = data.subtitle;

      // Show the edit form
      document.getElementById('editFormContainer').style.display = 'block';
    })
    .catch(error => {
      console.error('Error:', error.message);
    });
}

// Function to handle form submission for updating the story
document.getElementById('editStoryForm').addEventListener('submit', function (e) {
  e.preventDefault();

  // Get form data
  const formData = new FormData(document.getElementById('editStoryForm'));
  const storyId = formData.get('sid');

  // Send a PUT request to update the story
  fetch(`http://18.214.88.216:80/api/stories/${storyId}`, {
    method: 'PUT',
    body: formData,
  })
    .then(response => {
      if (!response.ok) {
        throw new Error('Failed to update story');
      }
      return response.json();
    })
    .then(data => {
      // Close the edit form
      document.getElementById('editFormContainer').style.display = 'none';

      // Refresh the stories list or update the edited story in the list
      fetchAndPopulateStoriesList();
    })
    .catch(error => {
      console.error('Error:', error.message);
    });
});

// Function to cancel the edit and hide the edit form
function cancelEdit() {
  document.getElementById('editFormContainer').style.display = 'none';
}



//put method to save the changes
document.getElementById('pricingForm').addEventListener('submit', function(event) {
    event.preventDefault();
    
    const formData = new FormData();
    formData.append('title', document.getElementById('editTitle').value);
    formData.append('subtitle', document.getElementById('editSubtitle').value);
    formData.append('terms_and_conditions', document.getElementById('editTermsAndConditions').value);
    formData.append('price', document.getElementById('editPrice').value);
    
    const entryId = document.getElementById('editEntryId').value; // Retrieve entryId from the hidden input field

    // Show a SweetAlert confirmation before making the PUT request
    swal({
        title: 'Confirm Update',
        text: 'Are you sure you want to save the changes?',
        icon: 'warning',
        buttons: true,
        dangerMode: true,
    }).then((willUpdate) => {
        if (willUpdate) {
            // Make the PUT request
            fetch(`http://18.214.88.216:80/api/pricing/pricing/${entryId}`, {
                method: 'PUT',
                body: formData,
            })
            .then(response => response.json())
            .then(updatedData => {
                // Show success message with SweetAlert
                swal('Success', 'Entry updated successfully', 'success');
                closeEditModal();
            })
            .catch(error => {
                // Show error message with SweetAlert
                swal('Error', 'Failed to update entry', 'error');
                console.error('Error updating entry:', error);
            });
        }
    });
});
</script>

<script>
function deleteAppointmentEntry(id) {
  Swal.fire({
    title: 'Are you sure?',
    text: 'You will not be able to recover this appointment entry!',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Yes, delete it!',
    cancelButtonText: 'No, cancel',
    reverseButtons: true,
    customClass: {
      popup: 'custom-sweet-alert',
    },
  }).then((result) => {
    if (result.isConfirmed) {
      fetch(`http://18.214.88.216:80/api/appointment/appointment/${id}`, {
        method: 'DELETE',
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error('Failed to delete Appointment story entry');
          }
          return response.json();
        })
        .then((data) => {
          console.log('Appointment entry deleted successfully:', data);
          fetchAndPopulateTable();

          // Update the row indices
          const rows = document.querySelectorAll('#appointmentTableBody tr');

          // Get the index of the row to be deleted
          const deletedRowIndex = rows.indexOf(event.target.parentElement.parentElement);

          // Decrement the index number of all rows after the deleted row
          for (let i = deletedRowIndex + 1; i < rows.length; i++) {
            const row = rows[i];
            const indexCell = row.querySelector('.index-cell');
            if (indexCell) {
              indexCell.textContent = i;
            }
          }
        })
        .catch((error) => {
          console.error('Error:', error.message);
        });
    }
  });
}
  document.getElementById('appointmentTableBody').addEventListener('click', function (event) {
    if (event.target && event.target.matches('button.delete-btn')) {
      const appEntryId = event.target.dataset.id;
      deleteAppointmentEntry(appEntryId);
    }
  });
  </script>
        


<!-- to delete contacts -->
<script>
 
  function deleteContactEntry(id) {
   // Use SweetAlert for confirmation
   Swal.fire({
     title: 'Are you sure?',
     text: 'You will not be able to recover this contact entry!',
     icon: 'warning',
     showCancelButton: true,
     confirmButtonText: 'Yes, delete it!',
     cancelButtonText: 'No, cancel',
     reverseButtons: true,
     customClass: {
         popup: 'custom-sweet-alert', // Add your custom class here
       },
   }).then((result) => {
     if (result.isConfirmed) {
       // User confirmed, proceed with deletion
       fetch(`http://18.214.88.216:80/api/contactus/contact/${id}`, {
         method: 'DELETE',
       })
         .then((response) => {
           if (!response.ok) {
             throw new Error('Failed to delete Contact story entry');
           }
           return response.json();
         })
         .then((data) => {
           console.log('Contact entry deleted successfully:', data);
           // After successful deletion, re-fetch and populate the table
           fetchAndPopulateTable();
         })
         .catch((error) => {
           console.error('Error:', error.message);
         });
     }
   });
 }
 
 // Attach the deleteContactEntry() function to the onclick event of each delete button in the contact list
 document.getElementById('contactTableBody').addEventListener('click', function (event) {
   if (event.target && event.target.matches('button.delete-btn')) {
     const conEntryId = event.target.dataset.id;
     deleteContactEntry(conEntryId);
   }
 });
 
 </script> 
 
 <!-- to delete pricing entry -->
<script>
  function deletePricingEntry(id) {
   // Use SweetAlert for confirmation
   Swal.fire({
     title: 'Are you sure?',
     text: 'You will not be able to recover this pricing entry!',
     icon: 'warning',
     showCancelButton: true,
     confirmButtonText: 'Yes, delete it!',
     cancelButtonText: 'No, cancel',
     reverseButtons: true,
     customClass: {
         popup: 'custom-sweet-alert', // Add your custom class here
       },
   }).then((result) => {
     if (result.isConfirmed) {
       // User confirmed, proceed with deletion
       const url = `http://18.214.88.216:80/api/pricing/pricing/${id}`;
       const method = 'DELETE';
 
       fetch(url, {
         method,
       })
         .then((response) => {
           if (!response.ok) {
             throw new Error('Failed to delete pricing entry');
           }
           return response.json();
         })
         .then((data) => {
           console.log('Pricing entry deleted successfully:', data);
           // After successful deletion, re-fetch and populate the pricing list
           fetchAndPopulatePricingList();
         })
         .catch((error) => {
           console.error('Error:', error.message);
         });
     }
   });
 }
 
 </script>
 
 </script>
 
 
 <!-- to delete stories  -->
 <script>
   function deleteStoryEntry(id) {
     // Use SweetAlert for confirmation
     Swal.fire({
       title: 'Are you sure?',
       text: 'You will not be able to recover this story entry!',
       icon: 'warning',
       showCancelButton: true,
       confirmButtonText: 'Yes, delete it!',
       cancelButtonText: 'No, cancel',
       reverseButtons: true,
       customClass: {
         popup: 'custom-sweet-alert', // Add your custom class here
       },
     }).then((result) => {
       if (result.isConfirmed) {
         // User confirmed, proceed with deletion
         fetch(`http://18.214.88.216:80/api/stories/stories/${id}`, {
           method: 'DELETE',
         })
           .then((response) => {
             if (!response.ok) {
               throw new Error('Failed to delete story entry');
             }
             return response.json();
           })
           .then((data) => {
             console.log('Story entry deleted successfully:', data);
             // After successful deletion, re-fetch and populate the stories list
             fetchAndPopulateStoriesList();
           })
           .catch((error) => {
             console.error('Error:', error.message);
           });
       }
     });
   }
 
   // Attach the deleteStoryEntry() function to the onclick event of each delete button in the stories list
   document.getElementById('storiesListTableBody').addEventListener('click', function (event) {
     if (event.target && event.target.matches('button.delete-btn')) {
       const storyEntryId = event.target.dataset.id;
       deleteStoryEntry(storyEntryId);
     }
   });
 </script>
 
   </script> 




</body>
</html>
